# Miscellaneous linux stuff

# Misc

## Sending and receiving files with netcat

Receiver: `nc -l -p 1234 > out.file`
Sender: `nc -w 3 [destination] 1234 < out.file`

## Man pages

```
man -k searchword
man 5 searchword
apropos keyword
```

## RDP

```
xfreerdp /v:HOST:PORT /u:DOMAIN\USER or USER@DOMAIN
/d:DOMAIN /p:PASS
/drive:NAME_ON_TARGET,/LOCAL/PATH
```

## Generating md5 hash

`python3 -c 'import hashlib;print(hashlib.md5(b"adminpassword").hexdigest())'` - hexformat.

`echo -n "something" | md5sum` - hexformat.

`openssl passwd -1 [text]` - This will be crypt compatible. See [pw-generation.](pw-generation.md)

## Multi execute on files with find

```
find *localtion* *search-parameters* -exec *command* {} \;
```

## Quick file transfer servers

### Http

```
python3 -m http.server 80
python2 -m SimpleHTTPServer 80
```

### SMB

- https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py

By default impackets smbserver will launch a SMBv1 server, which is useful to if you don't want authentication - but it might not be allowed on a Windows machine.

Samba/SMB is installed on Kali by default, add a share in `/etc/samba/smb.conf`:

```
[my-share]
  comment = What is this
  path = /home/kali/tmp
  browseable = yes
  read only = yes
  guest ok = yes
```

Then start smbd: `sudo systemctl start smbd`.

### T/FTP

- https://stackoverflow.com/questions/4994638/one-line-ftp-server-in-python
- http://tftpy.sourceforge.net/sphinx/index.html

**FTP**

```
python3 -m pyftpdlib
```

**TFTP**

```
# Start a server
python3 -c "import tftpy; tftpy.TftpServer('/home/kali/tmp').listen('0.0.0.0', 69)"

# Download/Upload
python3 -c "import tftpy; tftpy.TftpClient('127.0.0.1', 69).download('REMOTE_FILENAME', 'LOCAL_FILENAME')"

python3 -c "import tftpy; tftpy.TftpClient('127.0.0.1', 69).upload('REMOTE_FILENAME', 'LOCAL_FILENAME')"
```


# Setting things up

## (Kali) Install and run LAMP

- https://betterprogramming.pub/how-to-install-lamp-stack-on-kali-linux-183fa4f48d16

- Apache2 and mysql-common packages installed by default. Ohterwise install.
- Install latest php package(8 something right now), metapackage.
- Install libapache2-mod-php*version*
- Start apache2, mysql services.

Create index.php in /var/www/html:
```php
<?php
  phpinfo()
?>
```
And browse to it to check if its working.

To enable/disable mods in apache(changing versions) use a2dismod and a2enmod.

## (Kali or Arch) Setting up time and NTP

Easiest way to update via target NTP server is to install (kali) the ntpdate package and run: `sudo ntpdate [serverip]`.

There's a service installed but not used by default, ntp. Use systemctl to run and config file in '/etc/ntp.conf'.

If systemd is used it uses timedatectl and timesyncd for time. Config file in '/etc/systemd/timesyncd.conf'.
```
timedatectl
timedatectl set-time "YYYY-MM-DD HH:MM:SS"
timedatectl set-ntp [true | false]
timedatectl timesync-status
timedatectl show-timesync
```

Easiest way to get approx the same time if smb is enabled:

`sudo timedatectl set-time "$(nmap $IP -p 445 --script smb2-time | grep date -m 1 | cut -d ":" -f 2- | tr "T" " ")"`

Only changes local time, might have to adjust time zones or universal time to get ex Kerberos working.

## (Kali) Using Kerberos

On kali, to use kerberos network authentication, install the 'krb5-user' package. Configuration in '/etc/krb5.conf'. To use domain:

![krb5-domain](assets/markdown-img-paste-20211107155106440.png)

## (Kali) Setting up a DHCP server

- [Ubuntu community docs](https://help.ubuntu.com/community/isc-dhcp-server)
- [Debian wiki](https://wiki.debian.org/DHCP_Server)


To set up boxes running virtually, or sometimes to exploit, you might have to set up your own DHCP server.

- Install the 'isc-dhcp-server' package.
- Edit the `/etc/dhcp/dhcpd.conf`
- Start the service with service or systemctl.
- Current leases will be written to `/var/lib/dhcp/dhcpd.leases`

## (Kali) Bloodhound and neo4j

```
sudo apt install bloodhound
```

This will install both bloodhound and neo4j packages.

```
cd /usr/share/neo4j/bin
sudo ./neo4j-admin set-initial-password NEW_PASSWORD
sudo neo4j console
bloodhound
```

Log in with user neo4j and new password.
