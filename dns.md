# DNS

## dnsrecon

```
# Brute reverse lookup
dnsrecon -r 192.168.0.0/16 -n *DNSIP*

# Host and Subdomain brute
dnsrecon -d [domain.com] -D wl.txt -t brt

# Zone transfer enum
dnsrecon -d [domain.com] -t axfr
```
T option is for type:
- brt = Brute force
- std = Standard DNS entries
- rvl = reverse lookup
- bing = bing subdomain search

## dnsenum

```
dnsenum [domain.com]
```

## NSE

```
# dnz-sone-transfer
nmap --script=dns-zone-transfer -p 53 ns.domain.com
```

## Other CLI tools

### host
```
# Simple A record lookup
host www.myhost.com

# Type of record
host -t A | MX | CNAME | TXT | NS | PTR www.myhost.com

# Verbose and all type of records
host -v -a www.myhost.com

# Query specific server
host -v -a www.myhost.com mydnsserverip

# Zone transfer
host -l domain.com ns.domain.com
```

#### Host examples

```
# Forward brute lookup
for name in $(cat ip.txt); do host $name.myhost.com; done | grep -v NXDOMAIN

# Reverse brute lookup
for ip in {50..100}; do host 149.56.244.$ip; done | grep -v NXDOMAIN

# Get nameservers for domain
host -t ns megacorpone.com | cut -d " " -f 4 | sed 's/.$//' > $(date +%F)-ns.txt

# Get nameservers and try zonetransfer
# Saves (date)-ns and (date)-zt for nameservers and zone transfers.
domain=megacorpone.com; host -t ns $domain | cut -d " " -f 4 | sed 's/.$//' > $(date +%F)-ns.txt && while read ns; do host -l $domain $ns; done < $(date +%F)-ns.txt | tee $(date +%F)-zt.txt

# Cleaner version of above, set variable target-domain before execution
for ns in $(host -t ns $targetdomain | cut -d " " -f 4); do host -l $targetdomain $ns; done
```

### nslookup

```
SERVER *IP*
*IP*
*NAME*
```

### dig

```
# Check for zone transfers
dig axfr @*IP*
dig axfr zone/dns @*IP*
```

### ffuf

**Virtual hosts**

Modify the host header in the request to check for virtual hosts.

`ffuf -u http://www.domain.com -w subdomanlist.txt:FUZZ -H "Host: FUZZ.domain.com" -fs [size]`

Run once without the filter size option(-fs) to find out the size.

## Subdomain enumeration

#### SSL/TSL Certificates
- https://crt.sh/
- https://transparencyreport.google.com/https/certificates

CA keep track of valid certificates in CT logs(Certificate Transparency). If you can find the CA's logs online you can find a list of valid certs and subdomains.

#### Google dorking
Search for subdomains only.

`-site www.site-address.com site:*.site-address.com`

### sublist3r

`sublist3r.py -d [domain.com]`

## Python dns module

```python
# Resolve
dns.resolver.resolve('domain.com','A')
# Example, prints the first record received
print(dns.resolver.resolve('www.google.com','A')[0].to_text())
for ns in (dns.resolver.resolve('domain.com','NS')):
  print(ns)

# Zone transfers

# Zone class

```
